<template>
  <lightning-card>
    <lightning-button-icon
      icon-name="utility:add"
      slot="actions"
      onclick={newLeaveRequest}
      variant="border-filled"
      alternative-text="Add New Leave Request"
    ></lightning-button-icon>
    
    <template lwc:if={myLeaves.length}>
      <lightning-datatable
        key-field="Id"
        data={myLeaves}
        columns={columns}
        onrowaction={handleRowAction}
        hide-checkbox-column
      ></lightning-datatable>
    </template>

    <template lwc:if={norecordsfound}>
      <div
        class="slds-align_absolute-center slds-p-around_small slds-text-heading_medium"
      >
        No Records Found
      </div>
    </template>
  </lightning-card>

  <!-- Modal for New/Edit Leave Request -->
  <template lwc:if={isEditModalOpen}>
    <section
      role="dialog"
      tabindex="-1"
      aria-modal="true"
      aria-labelledby="modal-heading-01"
      class="slds-modal slds-fade-in-open slds-modal_medium"
    >
      <div class="slds-modal__container">
        <button
          class="slds-button slds-button_icon slds-modal__close"
          onclick={closeEditModal}
          title="Close"
        >
          <lightning-icon
            icon-name="utility:close"
            alternative-text="close"
            size="small"
            variant="inverse"
          ></lightning-icon>
          <span class="slds-assistive-text">Cancel and close</span>
        </button>
        
        <div class="slds-modal__header">
          <h1
            id="modal-heading-01"
            class="slds-modal__title slds-hyphenate"
            tabindex="-1"
          >
            {modalname}
          </h1>
        </div>
        
        <div
          class="slds-modal__content slds-p-around_medium"
          id="modal-content-id-1"
        >
          <lightning-record-edit-form
            object-api-name="Leave_Request__c"
            record-id={recordId}
            onsuccess={handleSuccess}
            onerror={handleError}
            onsubmit={handleSubmit}
          >
            <!-- Hide User field for existing records, show for new records -->
            <template lwc:if={recordId}>
              <lightning-output-field 
                field-name="User__c"
              ></lightning-output-field>
            </template>
            <template lwc:else>
              <lightning-input-field 
                field-name="User__c" 
                value={currentuserid}
                disabled
              ></lightning-input-field>
            </template>

            <lightning-input-field
              field-name="FromDate__c"
              required
            ></lightning-input-field>

            <lightning-input-field
              field-name="ToDate__c"
              required
            ></lightning-input-field>

            <lightning-input-field
              field-name="Reason__c"
              required
            ></lightning-input-field>

            <!-- Show Status field only for existing records in edit mode -->
            <template lwc:if={recordId}>
              <lightning-output-field
                field-name="Status__c"
              ></lightning-output-field>
              
              <lightning-output-field
                field-name="ManagerComment__c"
              ></lightning-output-field>
            </template>

            <div class="slds-m-top_medium">
              <lightning-button
                variant="neutral"
                label="Cancel"
                onclick={closeEditModal}
                class="slds-m-right_small"
              ></lightning-button>

              <lightning-button
                type="submit"
                label="Save"
                variant="brand"
              ></lightning-button>
            </div>
          </lightning-record-edit-form>
        </div>
      </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
  </template>
</template>